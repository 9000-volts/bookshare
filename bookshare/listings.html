<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Listings - Book Sharing</title>
    <link href='https://fonts.googleapis.com/css?family=Oleo+Script|Slabo+27px' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style.css">
    <script src="/socket.io/socket.io.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70945415-1', 'auto');
  ga('send', 'pageview');

</script>
  </head>
  <body>
    <div id="add" class="dialog">
      <h1>Add a Listing</h1>
      <input type="text" id="listingname" placeholder="Listing Name">
      <input type="text" id="listingemail" placeholder="Your Email">
      <button id="completelisting" class="green">Add Listing</button>
      <button id="abortlisting" class="red">Cancel</button>
    </div>
    <div id="remove" class="dialog">
      <h1>Remove Listing</h1>
      <input type="text" id="remove-code" placeholder="Your Removal Code">
      <button id="removelisting" class="green">Remove Listing</button>
      <button id="abortrem" class="red">Cancel</button>
    </div>
    <div id="request" class="dialog">
      <h1>Request Listing</h1>
      <input type="text" id="request-address" placeolder="Recieving Address">
      <button id="requestlisting" class="green">Request Listing</button>
      <button id="abortreq" class="red">Cancel</button>
    </div>
    <header>
      Book Listings!
    </header>
    <div id="addlisting">
      <h1>Click Here to Add a Listing!</h1>
    </div>
    <div id="listings">
    </div>
    <script>
      var socket = io();
      var concerning = -1;
      socket.on("connect", function () {
        socket.emit("connection-bookshare-listings");
        document.querySelector("#addlisting").onclick = function () {
          document.querySelector("#add").style.display = "block";
        };
        var hideAdd = function () {
          document.querySelector("#add").style.display = "none";
        };
        var hideRemove = function () {
          document.querySelector("#remove").style.display = "none";
        };
        var hideRequest = function () {
          document.querySelector("#request").style.display = "none";
        };
        document.querySelector("#abortlisting").onclick = hideAdd;
        document.querySelector("#abortrem").onclick = hideRemove;
        document.querySelector("#abortreq").onclick = hideRequest;
        document.querySelector("#completelisting").onclick = function () {
          hideAdd();
          socket.emit("add-listing",
            document.querySelector("#listingemail").value,
            document.querySelector("#listingname").value);
        };
        document.querySelector("#removelisting").onclick = function () {
          hideRemove();
          socket.emit("remove-listing", concerning,
            document.querySelector("#remove-code").value);
        };
        document.querySelector("#requestlisting").onclick = function () {
          hideRequest();
          socket.emit("request-listing", concerning,
            document.querySelector("#request-address").value);
        };
        socket.on("listings", function (listings) {
          var listingdiv = document.querySelector("#listings");
          listingdiv.innerHTML = "";
          listings.forEach(function(listing) {
            var listingbox = document.createElement("div");
            listingbox.innerHTML = listing.information;
            var listingbutton = document.createElement("button");
            listingbutton.className = "action";
            listingbutton.innerHTML = "Request Book";
            listingbutton.onclick = function () {
              concerning = listing.index;
              document.querySelector("#request").style.display = "block";
            };
            listingbox.appendChild(listingbutton);
            var removebutton = document.createElement("button");
            removebutton.className = "action";
            removebutton.innerHTML = "Remove Listing";
            removebutton.onclick = function () {
              concerning = listing.index;
              document.querySelector("#remove").style.display = "block";
            };
            listingbox.appendChild(removebutton);
            listingdiv.appendChild(listingbox);
          });
        });
        socket.on("reload", function () {
          window.location.reload();
        });
      });
    </script>
  </body>
</html>
